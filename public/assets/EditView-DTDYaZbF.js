import{u as R,s as $,b as C}from"./vendor-primevue-DIj4JoDf.js";import{_ as P,a as U}from"./PageHeader-BU16FMbG.js";import{Q as _,r as u,w as q,o as N,c as b,e as l,z as d,s as M,t as z,q as A,h as G,S as Q,P as H,d as h,n as J}from"./vendor-vue-CPcLwXa2.js";import{u as K,_ as W,V as X}from"./LoadingSkeleton-BfQSGWkT.js";import{_ as Y}from"./index-DpgkslQk.js";const Z={class:"edit-view"},ee={class:"max-w-4xl mx-auto p-6"},te={key:0},ae={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6"},se={class:"flex items-start gap-3"},re={class:"flex-1"},oe={class:"text-red-700"},ne={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ie={__name:"EditView",setup(le){const g=Q(),p=H(),m=R(),r=K(),E=_(()=>r.loading),v=_(()=>r.error),F=_(()=>r.submitting),o=u(null),c=u({}),f=u(""),x=u(null),S=u(!1),k=_(()=>o.value&&x.value&&!E.value&&!v.value),y=async()=>{const t=g.params.id;if(t)try{S.value=!0,c.value={};const[e,s]=await Promise.all([r.fetchItem(t),r.ensureSchemaLoaded().then(()=>r.schema)]),n=r.getDatabaseInfo(),a=n?.schema||s,D=n?.title||s?.title||"Item";if(!a){m.add({severity:"error",summary:"Schema Error",detail:"Failed to load database schema. Please try again.",life:3e3});return}if(!e){m.add({severity:"error",summary:"Item Not Found",detail:"The item you are trying to edit does not exist.",life:3e3}),p.push("/");return}x.value=a,f.value=D;const O=a?.properties?Object.fromEntries(Object.entries(a.properties).map(([w,i])=>{const B={...i,value:e[w]||"",name:i.name||w,number:i.number||null,select:i.select||null,multi_select:i.multi_select||null,format:i.type==="number"?i.number?.format||i.format:void 0};return[w,B]})):{};o.value=O}catch(e){console.error("Error loading item:",e)}finally{S.value=!1}},I=()=>{y()},V=t=>{Object.entries(t).forEach(([e,s])=>{o.value[e]&&(o.value[e].value=s)}),c.value={}},L=async()=>{if(!F.value)try{c.value={};const t=Object.fromEntries(Object.entries(o.value).map(([n,a])=>[n,a.value])),e=j(t,o.value);if(!e.isValid){c.value=e.errors;return}const s=g.params.id;await r.updateItem(s,t,x.value),m.add({severity:"success",summary:"Success",detail:`${f.value} updated successfully`,life:3e3}),await J(),p.push("/")}catch(t){console.error("Update failed:",t);const e=r.error||t?.message||`Failed to update ${f.value.toLowerCase()}`;m.add({severity:"error",summary:"Error",detail:e,life:5e3})}},j=(t,e)=>{const s={properties:Object.fromEntries(Object.entries(e).map(([n,a])=>[n,{type:a.type,required:a.required||!1,number:a.number,options:a.options,minLength:a.minLength,maxLength:a.maxLength}]))};return X.validateFormData(t,s)},T=()=>{p.push("/")};return q(()=>g.params.id,(t,e)=>{t&&t!==e&&y()},{immediate:!1}),N(()=>{y()}),(t,e)=>{const s=$,n=U,a=C;return h(),b("div",Z,[l("div",ee,[d(P,{mode:"edit","database-title":f.value,"show-back-button":!0,onGoBack:T},null,8,["database-title"]),E.value||!o.value&&!v.value?(h(),b("div",te,[d(W,{count:1,"container-class":"bg-white rounded-lg shadow-sm border border-gray-200 p-6"})])):v.value?(h(),b("div",ae,[l("div",se,[e[2]||(e[2]=l("i",{class:"pi pi-exclamation-triangle text-red-500 text-xl mt-1"},null,-1)),l("div",re,[e[1]||(e[1]=l("strong",{class:"text-red-800"},"Error:",-1)),l("span",oe,z(v.value),1),d(s,{onClick:I,class:"ml-2 !p-0 !bg-transparent !border-0 text-red-600 hover:text-red-800 underline !transition-colors",text:"",severity:"danger"},{default:A(()=>e[0]||(e[0]=[G(" Try Again ",-1)])),_:1,__:[0]})])])])):k.value?(h(),b("div",ne,[d(n,{"editing-item":o.value,submitting:F.value,"form-errors":c.value,onSubmitForm:L,onRefreshSchema:I,"onUpdate:formData":V,onCancelForm:T},null,8,["editing-item","submitting","form-errors"])])):M("",!0)]),d(a)])}}},fe=Y(ie,[["__scopeId","data-v-0504cd73"]]);export{fe as default};
