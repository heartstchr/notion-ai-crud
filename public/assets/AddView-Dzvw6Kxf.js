import{c as j,a as A,d as B}from"./vendor-primevue-DH71VHE2.js";import{_ as C,a as L}from"./PageHeader-DO4kptnS.js";import{r as c,y as R,o as N,c as w,z as h,p as q,s as V,e as l,t as z,q as M,h as W,O as G,N as Z,d as g,n as H}from"./vendor-vue-CD-XN-f4.js";import{u as J,i as k,_ as K}from"./LoadingSkeleton-COYHdY6R.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"add-view"},Y={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 mb-6"},ee={class:"flex items-center"},ae={class:"text-red-700 mt-1"},te={key:2,class:"relative"},se={class:"relative z-10 rounded-lg p-6"},re={__name:"AddView",setup(oe){const f=Z(),_=G(),x=j(),u=J(),b=c(!0),p=c(!1),n=c(""),i=c(null),m=c({}),v=c(""),d=c(null),$=R(()=>i.value&&d.value&&!b.value&&!n.value),I={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[+]?[1-9][\d]{0,15}$/},y=async()=>{b.value=!0,n.value="";try{const s=_.params.databaseId;if(s){const a=await k.getDatabaseInfo(s),e=a?.schema,r=a?.title||"Item";if(!e){n.value="Failed to load database schema. Please try again.";return}d.value=e,v.value=r}else{await u.fetchSchema();const a=u.getDatabaseInfo(),e=a?.schema||u.schema,r=a?.title||u.schema?.title||"Item";if(!e){n.value="Failed to load database schema. Please try again.";return}d.value=e,v.value=r}const t=d.value?.properties?Object.fromEntries(Object.entries(d.value.properties).map(([a,e])=>{const r={...e,value:"",name:e.name||a,number:e.number||null,select:e.select||null,multi_select:e.multi_select||null,format:e.type==="number"?e.number?.format||e.format:void 0};return[a,r]})):{};i.value=t,m.value={}}catch(s){console.error("Failed to load database schema:",s),n.value=s.message||"Failed to load database schema"}finally{b.value=!1}},F=async()=>{await y()},E=s=>{Object.entries(s).forEach(([t,a])=>{i.value[t]&&(i.value[t].value=a)}),m.value={}},O=async()=>{if(!p.value){p.value=!0;try{m.value={};const s=Object.fromEntries(Object.entries(i.value).map(([e,r])=>[e,r.value])),t=D(s,i.value);if(!t.isValid){m.value=t.errors;return}const a=_.params.databaseId;a?await k.createItem(s,d.value,a):await u.createItem(s),x.add({severity:"success",summary:"Success",detail:`${v.value} added successfully`,life:3e3}),await H(),a?f.push({name:"db-list",params:{databaseId:a}}):f.push("/")}catch(s){console.error("Create failed:",s);const t=s?.message||`Failed to add ${v.value.toLowerCase()}`;x.add({severity:"error",summary:"Error",detail:t,life:5e3})}finally{p.value=!1}}},D=(s,t)=>{const a={};return t?(Object.entries(t).forEach(([e,r])=>{const o=s[e],S=o?.toString().trim();if(r.required&&(!o||S==="")){a[e]=`${P(e)} is required`;return}if(o&&S!=="")switch(r.type){case"email":{I.email.test(o)||(a[e]="Please enter a valid email address");break}case"url":{try{new URL(o)}catch{!o.startsWith("http://")&&!o.startsWith("https://")&&(a[e]="Please enter a valid URL (include http:// or https://)")}break}case"phone_number":{const U=o.replace(/[\s\-()]/g,"");I.phone.test(U)||(a[e]="Please enter a valid phone number");break}}}),{isValid:Object.keys(a).length===0,errors:a}):{isValid:!0,errors:{}}},P=s=>s.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()).trim(),T=()=>{const s=_.params.databaseId;s?f.push({name:"db-list",params:{databaseId:s}}):f.push("/")};return N(()=>{y()}),(s,t)=>{const a=A,e=L,r=B;return g(),w("div",X,[h(C,{mode:"add","database-title":v.value,"show-back-button":!0,onGoBack:T},null,8,["database-title"]),b.value?(g(),q(K,{key:0,count:1})):n.value?(g(),w("div",Y,[l("div",ee,[t[1]||(t[1]=l("i",{class:"pi pi-exclamation-triangle text-red-500 mr-3 text-xl"},null,-1)),l("div",null,[t[0]||(t[0]=l("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Form",-1)),l("p",ae,z(n.value),1)])]),h(a,{onClick:F,severity:"danger",class:"mt-4"},{default:M(()=>t[2]||(t[2]=[W(" Try Again ",-1)])),_:1,__:[2]})])):V("",!0),$.value?(g(),w("div",te,[t[3]||(t[3]=l("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg",style:{filter:"drop-shadow(0 10px 25px rgba(0, 144, 247, 0.3)) drop-shadow(0 4px 6px rgba(186, 98, 252, 0.2)) drop-shadow(0 1px 3px rgba(242, 65, 107, 0.2)) drop-shadow(0 0 0 rgba(245, 86, 0, 0.1))"}},[l("div",{class:"bg-white rounded-lg h-full w-full"})],-1)),l("div",se,[h(e,{"editing-item":i.value,submitting:p.value,"form-errors":m.value,onSubmitForm:O,onRefreshSchema:F,"onUpdate:formData":E,onCancelForm:T},null,8,["editing-item","submitting","form-errors"])])])):V("",!0),h(r)])}}},ue=Q(re,[["__scopeId","data-v-6c22402b"]]);export{ue as default};
