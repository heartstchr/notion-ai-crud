import{u as A,s as B,b as C}from"./vendor-primevue-DIj4JoDf.js";import{_ as D,a as L}from"./PageHeader-BU16FMbG.js";import{Q as u,r as f,o as R,c as p,z as v,p as U,s as E,e as c,t as N,q,h as M,P as W,d as b,n as z}from"./vendor-vue-CPcLwXa2.js";import{u as G,_ as Q}from"./LoadingSkeleton-BfQSGWkT.js";import{_ as Z}from"./index-DpgkslQk.js";const H={class:"add-view"},J={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 mb-6"},K={class:"flex items-center"},X={class:"text-red-700 mt-1"},Y={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ee={__name:"AddView",setup(te){const g=W(),h=A(),o=G(),w=u(()=>o.loading),x=u(()=>o.submitting),_=u(()=>o.error),n=f(null),l=f({}),d=f(""),y=f(null),$=u(()=>n.value&&y.value&&!w.value&&!_.value),S={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[+]?[1-9][\d]{0,15}$/},F=async()=>{try{await o.fetchSchema();const t=o.getDatabaseInfo(),e=t?.schema||o.schema,s=t?.title||o.schema?.title||"Item";if(!e){h.add({severity:"error",summary:"Schema Error",detail:"Failed to load database schema. Please try again.",life:3e3});return}y.value=e,d.value=s;const r=e?.properties?Object.fromEntries(Object.entries(e.properties).map(([i,a])=>{const m={...a,value:"",name:a.name||i,number:a.number||null,select:a.select||null,multi_select:a.multi_select||null,format:a.type==="number"?a.number?.format||a.format:void 0};return[i,m]})):{};n.value=r,l.value={}}catch(t){console.error("Failed to load database schema:",t)}},T=async()=>{await F()},k=t=>{Object.entries(t).forEach(([e,s])=>{n.value[e]&&(n.value[e].value=s)}),l.value={}},I=async()=>{if(!x.value)try{l.value={};const t=Object.fromEntries(Object.entries(n.value).map(([s,r])=>[s,r.value])),e=O(t,n.value);if(!e.isValid){l.value=e.errors;return}await o.createItem(t),h.add({severity:"success",summary:"Success",detail:`${d.value} added successfully`,life:3e3}),await z(),g.push("/")}catch(t){console.error("Create failed:",t);const e=o.error||t?.message||`Failed to add ${d.value.toLowerCase()}`;h.add({severity:"error",summary:"Error",detail:e,life:5e3})}},O=(t,e)=>{const s={};return e?(Object.entries(e).forEach(([r,i])=>{const a=t[r],m=a?.toString().trim();if(i.required&&(!a||m==="")){s[r]=`${P(r)} is required`;return}if(a&&m!=="")switch(i.type){case"email":{S.email.test(a)||(s[r]="Please enter a valid email address");break}case"url":{try{new URL(a)}catch{!a.startsWith("http://")&&!a.startsWith("https://")&&(s[r]="Please enter a valid URL (include http:// or https://)")}break}case"phone_number":{const j=a.replace(/[\s\-()]/g,"");S.phone.test(j)||(s[r]="Please enter a valid phone number");break}}}),{isValid:Object.keys(s).length===0,errors:s}):{isValid:!0,errors:{}}},P=t=>t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),V=()=>{g.push("/")};return R(()=>{F()}),(t,e)=>{const s=B,r=L,i=C;return b(),p("div",H,[v(D,{mode:"add","database-title":d.value,"show-back-button":!0,onGoBack:V},null,8,["database-title"]),w.value?(b(),U(Q,{key:0,count:1})):_.value?(b(),p("div",J,[c("div",K,[e[1]||(e[1]=c("i",{class:"pi pi-exclamation-triangle text-red-500 mr-3 text-xl"},null,-1)),c("div",null,[e[0]||(e[0]=c("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Form",-1)),c("p",X,N(_.value),1)])]),v(s,{onClick:T,class:"mt-4 !px-4 !py-2 !bg-red-600 !text-white !rounded-md hover:!bg-red-700",severity:"danger"},{default:q(()=>e[2]||(e[2]=[M(" Try Again ",-1)])),_:1,__:[2]})])):E("",!0),$.value?(b(),p("div",Y,[v(r,{"editing-item":n.value,submitting:x.value,"form-errors":l.value,onSubmitForm:I,onRefreshSchema:T,"onUpdate:formData":k,onCancelForm:V},null,8,["editing-item","submitting","form-errors"])])):E("",!0),v(i)])}}},ie=Z(ee,[["__scopeId","data-v-bd8ff88e"]]);export{ie as default};
