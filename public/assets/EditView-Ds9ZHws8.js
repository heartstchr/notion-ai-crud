import{u as R,a as $,b as B}from"./vendor-primevue-CrmH8go6.js";import{u as P,_ as U,a as C}from"./PageHeader-DsRy69Wl.js";import{r as c,y as q,w as z,o as M,c as I,e as n,z as f,s as N,t as A,q as G,h as H,O as J,N as K,d as y,n as Q}from"./vendor-vue-UEcv-ZwY.js";import{_ as W,i as V,V as X}from"./LoadingSkeleton-Dtx_ymdI.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"edit-view"},ee={class:"max-w-4xl mx-auto p-6"},te={key:0},ae={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6"},se={class:"flex items-start gap-3"},oe={class:"flex-1"},ie={class:"text-red-700"},re={key:2,class:"relative"},le={class:"relative z-10 bg-white rounded-lg p-6"},ne={__name:"EditView",setup(de){const u=J(),p=K(),D=R(),m=P(),g=c(!0),d=c(""),h=c(!1),l=c(null),v=c({}),_=c(""),w=c(null);c(!1);const S=q(()=>l.value&&w.value&&!g.value&&!d.value),E=async()=>{const t=u.params.id,e=u.params.databaseId;if(t){g.value=!0,d.value="",v.value={};try{let a,s,o;if(e){const[r,i]=await Promise.all([V.getItem(t,e),V.getDatabaseInfo(e)]);a=r.result||r,s=i?.schema,o=i?.title||"Item",console.log("EditView - Database context - itemData:",r),console.log("EditView - Database context - itemResult:",a),console.log("EditView - Database context - schemaToUse:",s),console.log("EditView - Database context - itemResult keys:",Object.keys(a)),console.log("EditView - Database context - schemaToUse properties keys:",Object.keys(s?.properties||{}))}else{const[r,i]=await Promise.all([m.fetchItem(t),m.ensureSchemaLoaded().then(()=>m.schema)]),b=m.getDatabaseInfo();a=r.result||r,s=b?.schema||i,o=b?.title||i?.title||"Item"}if(!s){d.value="Failed to load database schema. Please try again.";return}if(!a){d.value="The item you are trying to edit does not exist.";return}w.value=s,_.value=o;const x=s?.properties?Object.fromEntries(Object.entries(s.properties).map(([r,i])=>{const b=a[r]||"",T={...i,value:b,name:i.name||r,number:i.number||null,select:i.select||null,multi_select:i.multi_select||null,format:i.type==="number"?i.number?.format||i.format:void 0};return console.log(`EditView - Field ${r}:`,{property:i,fieldValue:b,enrichedProperty:T}),[r,T]})):{};l.value=x,console.log("EditView - Final enrichedProperties:",x),console.log("EditView - Final item.value:",l.value)}catch(a){console.error("Error loading item:",a),d.value=a.message||"Failed to load item"}finally{g.value=!1}}},F=()=>{E()},O=t=>{Object.entries(t).forEach(([e,a])=>{l.value[e]&&(l.value[e].value=a)}),v.value={}},j=async()=>{if(!h.value){h.value=!0;try{v.value={};const t=Object.fromEntries(Object.entries(l.value).map(([x,r])=>[x,r.value])),e=L(t,l.value);if(!e.isValid){v.value=e.errors;return}const a=u.params.id,s=u.params.databaseId;s?await V.updateItem(a,t,w.value,s):await m.updateItem(a,t,w.value),D.add({severity:"success",summary:"Success",detail:`${_.value} updated successfully`,life:3e3}),await Q();const o=u.params.databaseId;o?p.push({name:"db-list",params:{databaseId:o}}):p.push("/")}catch(t){console.error("Update failed:",t);const e=t?.message||`Failed to update ${_.value.toLowerCase()}`;D.add({severity:"error",summary:"Error",detail:e,life:5e3})}finally{h.value=!1}}},L=(t,e)=>{const a={properties:Object.fromEntries(Object.entries(e).map(([s,o])=>[s,{type:o.type,required:o.required||!1,number:o.number,options:o.options,minLength:o.minLength,maxLength:o.maxLength}]))};return X.validateFormData(t,a)},k=()=>{const t=u.params.databaseId;t?p.push({name:"db-list",params:{databaseId:t}}):p.push("/")};return z(()=>u.params.id,(t,e)=>{t&&t!==e&&E()},{immediate:!1}),M(()=>{E()}),(t,e)=>{const a=$,s=C,o=B;return y(),I("div",Z,[n("div",ee,[f(U,{mode:"edit","database-title":_.value,"show-back-button":!0,onGoBack:k},null,8,["database-title"]),g.value||!l.value&&!d.value?(y(),I("div",te,[f(W,{count:1,"container-class":"bg-white rounded-lg shadow-sm border border-gray-200 p-6"})])):d.value?(y(),I("div",ae,[n("div",se,[e[2]||(e[2]=n("i",{class:"pi pi-exclamation-triangle text-red-500 text-xl mt-1"},null,-1)),n("div",oe,[e[1]||(e[1]=n("strong",{class:"text-red-800"},"Error:",-1)),n("span",ie,A(d.value),1),f(a,{onClick:F,severity:"danger",text:""},{default:G(()=>e[0]||(e[0]=[H(" Try Again ",-1)])),_:1,__:[0]})])])])):S.value?(y(),I("div",re,[e[3]||(e[3]=n("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg",style:{filter:"drop-shadow(0 10px 25px rgba(0, 144, 247, 0.3)) drop-shadow(0 4px 6px rgba(186, 98, 252, 0.2)) drop-shadow(0 1px 3px rgba(242, 65, 107, 0.2)) drop-shadow(0 0 0 rgba(245, 86, 0, 0.1))"}},[n("div",{class:"bg-white rounded-lg h-full w-full"})],-1)),n("div",le,[f(s,{"editing-item":l.value,submitting:h.value,"form-errors":v.value,onSubmitForm:j,onRefreshSchema:F,"onUpdate:formData":O,onCancelForm:k},null,8,["editing-item","submitting","form-errors"])])])):N("",!0)]),f(o)])}}},fe=Y(ne,[["__scopeId","data-v-fde250af"]]);export{fe as default};
