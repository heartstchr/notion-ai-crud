import{c as B,a as C,d as D}from"./vendor-primevue-2Ru-362p.js";import{_ as L,a as P}from"./PageHeader-CwwLtnx2.js";import{y as m,r as f,o as R,c as p,z as v,p as U,s as E,e as c,t as N,q,h as M,Q as W,d as b,n as z}from"./vendor-vue-DX0NukY0.js";import{c as G,u as Q,_ as Z}from"./_plugin-vue_export-helper-DyRF7Wcn.js";const H={class:"add-view"},J={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6 mb-6"},K={class:"flex items-center"},X={class:"text-red-700 mt-1"},Y={key:2,class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},ee={__name:"AddView",setup(te){const g=W(),h=B(),o=Q(),w=m(()=>o.loading),x=m(()=>o.submitting),_=m(()=>o.error),n=f(null),l=f({}),d=f(""),y=f(null),$=m(()=>n.value&&y.value&&!w.value&&!_.value),S={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^[+]?[1-9][\d]{0,15}$/},F=async()=>{try{await o.fetchSchema();const t=o.getDatabaseInfo(),e=t?.schema||o.schema,s=t?.title||o.schema?.title||"Item";if(!e){h.add({severity:"error",summary:"Schema Error",detail:"Failed to load database schema. Please try again.",life:3e3});return}y.value=e,d.value=s;const r=e?.properties?Object.fromEntries(Object.entries(e.properties).map(([i,a])=>{const u={...a,value:"",name:a.name||i,number:a.number||null,select:a.select||null,multi_select:a.multi_select||null,format:a.type==="number"?a.number?.format||a.format:void 0};return[i,u]})):{};n.value=r,l.value={}}catch(t){console.error("Failed to load database schema:",t)}},T=async()=>{await F()},k=t=>{Object.entries(t).forEach(([e,s])=>{n.value[e]&&(n.value[e].value=s)}),l.value={}},I=async()=>{if(!x.value)try{l.value={};const t=Object.fromEntries(Object.entries(n.value).map(([s,r])=>[s,r.value])),e=O(t,n.value);if(!e.isValid){l.value=e.errors;return}await o.createItem(t),h.add({severity:"success",summary:"Success",detail:`${d.value} added successfully`,life:3e3}),await z(),g.push("/")}catch(t){console.error("Create failed:",t);const e=o.error||t?.message||`Failed to add ${d.value.toLowerCase()}`;h.add({severity:"error",summary:"Error",detail:e,life:5e3})}},O=(t,e)=>{const s={};return e?(Object.entries(e).forEach(([r,i])=>{const a=t[r],u=a?.toString().trim();if(i.required&&(!a||u==="")){s[r]=`${j(r)} is required`;return}if(a&&u!=="")switch(i.type){case"email":{S.email.test(a)||(s[r]="Please enter a valid email address");break}case"url":{try{new URL(a)}catch{!a.startsWith("http://")&&!a.startsWith("https://")&&(s[r]="Please enter a valid URL (include http:// or https://)")}break}case"phone_number":{const A=a.replace(/[\s\-()]/g,"");S.phone.test(A)||(s[r]="Please enter a valid phone number");break}}}),{isValid:Object.keys(s).length===0,errors:s}):{isValid:!0,errors:{}}},j=t=>t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim(),V=()=>{g.push("/")};return R(()=>{F()}),(t,e)=>{const s=C,r=P,i=D;return b(),p("div",H,[v(L,{mode:"add","database-title":d.value,"show-back-button":!0,onGoBack:V},null,8,["database-title"]),w.value?(b(),U(Z,{key:0,count:1})):_.value?(b(),p("div",J,[c("div",K,[e[1]||(e[1]=c("i",{class:"pi pi-exclamation-triangle text-red-500 mr-3 text-xl"},null,-1)),c("div",null,[e[0]||(e[0]=c("h3",{class:"text-lg font-medium text-red-800"},"Error Loading Form",-1)),c("p",X,N(_.value),1)])]),v(s,{onClick:T,severity:"danger",class:"mt-4"},{default:q(()=>e[2]||(e[2]=[M(" Try Again ",-1)])),_:1,__:[2]})])):E("",!0),$.value?(b(),p("div",Y,[v(r,{"editing-item":n.value,submitting:x.value,"form-errors":l.value,onSubmitForm:I,onRefreshSchema:T,"onUpdate:formData":k,onCancelForm:V},null,8,["editing-item","submitting","form-errors"])])):E("",!0),v(i)])}}},ne=G(ee,[["__scopeId","data-v-3d4461cf"]]);export{ne as default};
