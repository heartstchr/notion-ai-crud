import{c as $,a as B,d as P}from"./vendor-primevue-DpBz6RqP.js";import{_ as C,a as R}from"./PageHeader-DHb2OxVv.js";import{r as u,y as U,w as q,o as z,c as I,e as n,z as b,s as M,t as N,q as A,h as G,O as H,N as J,d as y,n as K}from"./vendor-vue-UEcv-ZwY.js";import{u as Q,_ as W,i as E,V as X}from"./LoadingSkeleton-CA9fH1lU.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"edit-view"},ee={class:"max-w-4xl mx-auto p-6"},te={key:0},ae={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-6"},se={class:"flex items-start gap-3"},oe={class:"flex-1"},re={class:"text-red-700"},ie={key:2,class:"relative"},le={class:"relative z-10 bg-white rounded-lg p-6"},ne={__name:"EditView",setup(de){const c=H(),p=J(),V=$(),m=Q(),g=u(!0),d=u(""),h=u(!1),l=u(null),v=u({}),_=u(""),w=u(null);u(!1);const T=U(()=>l.value&&w.value&&!g.value&&!d.value),F=async()=>{const t=c.params.id,e=c.params.databaseId;if(t){g.value=!0,d.value="",v.value={};try{let a,r,s;if(e){const[i,o]=await Promise.all([E.getItem(t,e),E.getDatabaseInfo(e)]);a=i.result||i,r=o?.schema,s=o?.title||"Item"}else{const[i,o]=await Promise.all([m.fetchItem(t),m.ensureSchemaLoaded().then(()=>m.schema)]),f=m.getDatabaseInfo();a=i.result||i,r=f?.schema||o,s=f?.title||o?.title||"Item"}if(!r){d.value="Failed to load database schema. Please try again.";return}if(!a){d.value="The item you are trying to edit does not exist.";return}w.value=r,_.value=s;const x=r?.properties?Object.fromEntries(Object.entries(r.properties).map(([i,o])=>{const f=a[i]||"",k={...o,value:f,name:o.name||i,number:o.number||null,select:o.select||null,multi_select:o.multi_select||null,format:o.type==="number"?o.number?.format||o.format:void 0};return console.log(`EditView - Field ${i}:`,{property:o,fieldValue:f,enrichedProperty:k}),[i,k]})):{};l.value=x,console.log("EditView - Final enrichedProperties:",x),console.log("EditView - Final item.value:",l.value)}catch(a){console.error("Error loading item:",a),d.value=a.message||"Failed to load item"}finally{g.value=!1}}},D=()=>{F()},O=t=>{Object.entries(t).forEach(([e,a])=>{l.value[e]&&(l.value[e].value=a)}),v.value={}},j=async()=>{if(!h.value){h.value=!0;try{v.value={};const t=Object.fromEntries(Object.entries(l.value).map(([x,i])=>[x,i.value])),e=L(t,l.value);if(!e.isValid){v.value=e.errors;return}const a=c.params.id,r=c.params.databaseId;r?await E.updateItem(a,t,w.value,r):await m.updateItem(a,t,w.value),V.add({severity:"success",summary:"Success",detail:`${_.value} updated successfully`,life:3e3}),await K();const s=c.params.databaseId;s?p.push({name:"db-list",params:{databaseId:s}}):p.push("/")}catch(t){console.error("Update failed:",t);const e=t?.message||`Failed to update ${_.value.toLowerCase()}`;V.add({severity:"error",summary:"Error",detail:e,life:5e3})}finally{h.value=!1}}},L=(t,e)=>{const a={properties:Object.fromEntries(Object.entries(e).map(([r,s])=>[r,{type:s.type,required:s.required||!1,number:s.number,options:s.options,minLength:s.minLength,maxLength:s.maxLength}]))};return X.validateFormData(t,a)},S=()=>{const t=c.params.databaseId;t?p.push({name:"db-list",params:{databaseId:t}}):p.push("/")};return q(()=>c.params.id,(t,e)=>{t&&t!==e&&F()},{immediate:!1}),z(()=>{F()}),(t,e)=>{const a=B,r=R,s=P;return y(),I("div",Z,[n("div",ee,[b(C,{mode:"edit","database-title":_.value,"show-back-button":!0,onGoBack:S},null,8,["database-title"]),g.value||!l.value&&!d.value?(y(),I("div",te,[b(W,{count:1,"container-class":"bg-white rounded-lg shadow-sm border border-gray-200 p-6"})])):d.value?(y(),I("div",ae,[n("div",se,[e[2]||(e[2]=n("i",{class:"pi pi-exclamation-triangle text-red-500 text-xl mt-1"},null,-1)),n("div",oe,[e[1]||(e[1]=n("strong",{class:"text-red-800"},"Error:",-1)),n("span",re,N(d.value),1),b(a,{onClick:D,severity:"danger",text:""},{default:A(()=>e[0]||(e[0]=[G(" Try Again ",-1)])),_:1,__:[0]})])])])):T.value?(y(),I("div",ie,[e[3]||(e[3]=n("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-500 via-purple-500 via-pink-500 to-orange-500 rounded-lg p-0.5 shadow-lg",style:{filter:"drop-shadow(0 10px 25px rgba(0, 144, 247, 0.3)) drop-shadow(0 4px 6px rgba(186, 98, 252, 0.2)) drop-shadow(0 1px 3px rgba(242, 65, 107, 0.2)) drop-shadow(0 0 0 rgba(245, 86, 0, 0.1))"}},[n("div",{class:"bg-white rounded-lg h-full w-full"})],-1)),n("div",le,[b(r,{"editing-item":l.value,submitting:h.value,"form-errors":v.value,onSubmitForm:j,onRefreshSchema:D,"onUpdate:formData":O,onCancelForm:S},null,8,["editing-item","submitting","form-errors"])])])):M("",!0)]),b(s)])}}},be=Y(ne,[["__scopeId","data-v-d0b5117d"]]);export{be as default};
